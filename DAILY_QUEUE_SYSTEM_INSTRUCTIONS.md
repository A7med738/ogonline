# نظام الطابور اليومي البسيط - نظام احجزلي

## ❌ **المشكلة السابقة:**
```
ERROR: 42703: column "queue_number" does not exist
```

## 🎯 **المفهوم الجديد:**
**كل دكتور له طابور واحد فقط على مدار اليوم**

## ✅ **الحل:**

### **الخطوة 1: استخدام الملف المبسط**

**استخدم ملف `SIMPLE_DAILY_QUEUE_SYSTEM.sql` - هذا هو الملف المبسط**

### **الخطوة 2: تشغيل SQL في Supabase Dashboard**

1. **افتح Supabase Dashboard:**
   - اذهب إلى: https://supabase.com/dashboard
   - اختر مشروعك

2. **افتح SQL Editor:**
   - اضغط على "SQL Editor" في القائمة الجانبية
   - اضغط على "New query"

3. **انسخ والصق الكود:**
   - افتح ملف `SIMPLE_DAILY_QUEUE_SYSTEM.sql`
   - انسخ جميع محتويات الملف
   - الصق في SQL Editor

4. **شغل الكود:**
   - اضغط على "Run" أو `Ctrl+Enter`
   - انتظر حتى يكتمل التنفيذ

### **الخطوة 3: التحقق من الجداول**

1. **اذهب إلى Table Editor:**
   - اضغط على "Table Editor" في القائمة الجانبية

2. **تحقق من الجداول الجديدة:**
   - `book_service_health_centers`
   - `book_service_clinics`
   - `book_service_appointments`
   - `book_service_daily_queues`

## 🔧 **ما تم تبسيطه:**

### **1. نظام الطابور اليومي:**
- **طابور واحد فقط لكل دكتور في اليوم**
- **رقم طابور يبدأ من 1 وينتهي عند آخر مريض**
- **موضع المريض في الطابور (1, 2, 3, ...)**

### **2. الجداول المبسطة:**
- `book_service_health_centers` - المراكز الصحية
- `book_service_clinics` - العيادات والأطباء
- `book_service_appointments` - الحجوزات مع رقم الطابور
- `book_service_daily_queues` - الطابور اليومي لكل عيادة

### **3. الوظائف المبسطة:**
- `get_next_daily_queue_number()` - حساب رقم الطابور التالي
- `calculate_daily_queue_position()` - حساب موضع المريض
- `update_daily_queue_on_appointment()` - تحديث الطابور تلقائياً

## 📋 **كيف يعمل النظام:**

### **عند حجز موعد جديد:**
1. **النظام يحسب رقم الطابور التالي** (1, 2, 3, ...)
2. **يحسب موضع المريض في الطابور** (1, 2, 3, ...)
3. **يحدث الطابور اليومي للعيادة**
4. **يحفظ الحجز مع رقم الطابور**

### **مثال على الطابور:**
```
عيادة الطب العام - د. أحمد محمد
اليوم: 2025-01-25

الطابور:
1. أحمد محمد (رقم الطابور: 1, الموضع: 1)
2. فاطمة علي (رقم الطابور: 2, الموضع: 2)
3. خالد عبدالله (رقم الطابور: 3, الموضع: 3)
4. نورا سعد (رقم الطابور: 4, الموضع: 4)
```

## 🎯 **البيانات التجريبية:**

### **المركز الصحي:**
- **الاسم:** مركز الصحة الشامل
- **العنوان:** شارع الملك فهد، حي النخيل، الرياض
- **الهاتف:** +966501234567
- **التقييم:** 4.8/5

### **العيادات:**
1. **عيادة الطب العام** - د. أحمد محمد (150 ريال)
2. **عيادة الأطفال** - د. فاطمة علي (200 ريال)
3. **عيادة النساء والولادة** - د. مريم حسن (300 ريال)
4. **عيادة الأسنان** - د. خالد عبدالله (250 ريال)
5. **عيادة العيون** - د. نورا سعد (180 ريال)
6. **عيادة الأنف والأذن** - د. عمر يوسف (220 ريال)
7. **عيادة الجلدية** - د. لينا محمود (200 ريال)
8. **عيادة العظام** - د. سعد الدين (280 ريال)
9. **عيادة القلب** - د. هدى أحمد (350 ريال)
10. **عيادة الأعصاب** - د. يوسف محمد (320 ريال)
11. **عيادة الباطنة** - د. ريم عبدالرحمن (240 ريال)

## 🎯 **النتيجة المتوقعة:**

بعد تشغيل SQL:
- ✅ **الحجز سيعمل بدون أخطاء**
- ✅ **نظام الطابور اليومي سيعمل تلقائياً**
- ✅ **المريض سيحصل على رقم طابور (1, 2, 3, ...)**
- ✅ **المريض سيرى موضعه في الطابور**
- ✅ **كل دكتور له طابور واحد فقط في اليوم**

## ⚠️ **ملاحظات مهمة:**

1. **استخدم الملف المبسط:** `SIMPLE_DAILY_QUEUE_SYSTEM.sql`
2. **طابور واحد فقط لكل دكتور في اليوم**
3. **أرقام الطابور تبدأ من 1 وتتزايد**
4. **البيانات التجريبية جاهزة**
5. **النظام مبسط وسهل الفهم**

## 🚀 **الخطوات التالية:**

بعد تشغيل SQL بنجاح:
1. **ارجع للتطبيق**
2. **جرب حجز موعد جديد**
3. **تحقق من أن النظام يعمل بدون أخطاء**
4. **تأكد من ظهور البيانات التجريبية**
5. **جرب حجز عدة مواعيد لنفس العيادة لرؤية الطابور**

---
**تاريخ الإصلاح**: 2025-01-25  
**الحالة**: النظام المبسط جاهز ✅
