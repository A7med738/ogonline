# ุฅูุดุงุก ุงูุฌุฏุงูู ุงูุฃุณุงุณูุฉ ููุท - ูุธุงู ุงุญุฌุฒูู

## โ **ุงููุดููุฉ:**
```
ERROR: 42703: column "queue_number" does not exist
```

## ๐ฏ **ุงูุญู ุงููุจุณุท:**
**ุฅูุดุงุก ุงูุฌุฏุงูู ุงูุฃุณุงุณูุฉ ููุท ุจุฏูู trigger ุฃู ูุธุงุฆู ูุนูุฏุฉ**

## โ **ุงูุฎุทูุงุช:**

### **ุงูุฎุทูุฉ 1: ุงุณุชุฎุฏุงู ุงูููู ุงููุจุณุท**

**ุงุณุชุฎุฏู ููู `BASIC_TABLES_ONLY.sql` - ูุฐุง ูู ุงูููู ุงููุจุณุท**

### **ุงูุฎุทูุฉ 2: ุชุดุบูู SQL ูู Supabase Dashboard**

1. **ุงูุชุญ Supabase Dashboard:**
   - ุงุฐูุจ ุฅูู: https://supabase.com/dashboard
   - ุงุฎุชุฑ ูุดุฑูุนู

2. **ุงูุชุญ SQL Editor:**
   - ุงุถุบุท ุนูู "SQL Editor" ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ
   - ุงุถุบุท ุนูู "New query"

3. **ุงูุณุฎ ูุงูุตู ุงูููุฏ:**
   - ุงูุชุญ ููู `BASIC_TABLES_ONLY.sql`
   - ุงูุณุฎ ุฌููุน ูุญุชููุงุช ุงูููู
   - ุงูุตู ูู SQL Editor

4. **ุดุบู ุงูููุฏ:**
   - ุงุถุบุท ุนูู "Run" ุฃู `Ctrl+Enter`
   - ุงูุชุธุฑ ุญุชู ููุชูู ุงูุชูููุฐ

### **ุงูุฎุทูุฉ 3: ุงูุชุญูู ูู ุงูุฌุฏุงูู**

1. **ุงุฐูุจ ุฅูู Table Editor:**
   - ุงุถุบุท ุนูู "Table Editor" ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ

2. **ุชุญูู ูู ุงูุฌุฏุงูู ุงูุฌุฏูุฏุฉ:**
   - `book_service_health_centers`
   - `book_service_clinics`
   - `book_service_appointments`
   - `book_service_daily_queues`

## ๐ง **ูุง ุชู ุชุจุณูุทู:**

### **1. ุงูุฌุฏุงูู ุงูุฃุณุงุณูุฉ ููุท:**
- **ูุง ุชูุฌุฏ trigger**
- **ูุง ุชูุฌุฏ ูุธุงุฆู ูุนูุฏุฉ**
- **ูุง ุชูุฌุฏ ุญุณุงุจุงุช ุชููุงุฆูุฉ**
- **ุฌุฏุงูู ุจุณูุทุฉ ูุน ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ**

### **2. ุงูุฌุฏุงูู ุงูููุดุฃุฉ:**
- `book_service_health_centers` - ุงููุฑุงูุฒ ุงูุตุญูุฉ
- `book_service_clinics` - ุงูุนูุงุฏุงุช ูุงูุฃุทุจุงุก
- `book_service_appointments` - ุงูุญุฌูุฒุงุช ูุน ุฃุนูุฏุฉ ุงูุทุงุจูุฑ
- `book_service_daily_queues` - ุงูุทุงุจูุฑ ุงููููู ููู ุนูุงุฏุฉ

### **3. ุฃุนูุฏุฉ ุงูุทุงุจูุฑ:**
- `queue_number` - ุฑูู ุงูุทุงุจูุฑ (ุณูุชู ููุคู ูุฏููุงู ุฃู ุจุฑูุฌูุงู)
- `queue_position` - ููุถุน ุงููุฑูุถ ูู ุงูุทุงุจูุฑ

## ๐ **ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ:**

### **ุงููุฑูุฒ ุงูุตุญู:**
- **ุงูุงุณู:** ูุฑูุฒ ุงูุตุญุฉ ุงูุดุงูู
- **ุงูุนููุงู:** ุดุงุฑุน ุงูููู ููุฏุ ุญู ุงููุฎููุ ุงูุฑูุงุถ
- **ุงููุงุชู:** +966501234567
- **ุงูุชูููู:** 4.8/5

### **ุงูุนูุงุฏุงุช:**
1. **ุนูุงุฏุฉ ุงูุทุจ ุงูุนุงู** - ุฏ. ุฃุญูุฏ ูุญูุฏ (150 ุฑูุงู)
2. **ุนูุงุฏุฉ ุงูุฃุทูุงู** - ุฏ. ูุงุทูุฉ ุนูู (200 ุฑูุงู)
3. **ุนูุงุฏุฉ ุงููุณุงุก ูุงูููุงุฏุฉ** - ุฏ. ูุฑูู ุญุณู (300 ุฑูุงู)
4. **ุนูุงุฏุฉ ุงูุฃุณูุงู** - ุฏ. ุฎุงูุฏ ุนุจุฏุงููู (250 ุฑูุงู)
5. **ุนูุงุฏุฉ ุงูุนููู** - ุฏ. ููุฑุง ุณุนุฏ (180 ุฑูุงู)
6. **ุนูุงุฏุฉ ุงูุฃูู ูุงูุฃุฐู** - ุฏ. ุนูุฑ ููุณู (220 ุฑูุงู)
7. **ุนูุงุฏุฉ ุงูุฌูุฏูุฉ** - ุฏ. ูููุง ูุญููุฏ (200 ุฑูุงู)
8. **ุนูุงุฏุฉ ุงูุนุธุงู** - ุฏ. ุณุนุฏ ุงูุฏูู (280 ุฑูุงู)
9. **ุนูุงุฏุฉ ุงูููุจ** - ุฏ. ูุฏู ุฃุญูุฏ (350 ุฑูุงู)
10. **ุนูุงุฏุฉ ุงูุฃุนุตุงุจ** - ุฏ. ููุณู ูุญูุฏ (320 ุฑูุงู)
11. **ุนูุงุฏุฉ ุงูุจุงุทูุฉ** - ุฏ. ุฑูู ุนุจุฏุงูุฑุญูู (240 ุฑูุงู)

## ๐ฏ **ุงููุชูุฌุฉ ุงููุชููุนุฉ:**

ุจุนุฏ ุชุดุบูู SQL:
- โ **ุงูุฌุฏุงูู ุณุชููุดุฃ ุจุฏูู ุฃุฎุทุงุก**
- โ **ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ ุณุชููู ุฌุงูุฒุฉ**
- โ **ุฃุนูุฏุฉ ุงูุทุงุจูุฑ ุณุชููู ููุฌูุฏุฉ**
- โ **ุงููุธุงู ุณูุนูู ุจุดูู ุฃุณุงุณู**

## โ๏ธ **ููุงุญุธุงุช ูููุฉ:**

1. **ุงุณุชุฎุฏู ุงูููู ุงููุจุณุท:** `BASIC_TABLES_ONLY.sql`
2. **ูุง ุชูุฌุฏ trigger ุฃู ูุธุงุฆู ูุนูุฏุฉ**
3. **ุฃุนูุฏุฉ ุงูุทุงุจูุฑ ููุฌูุฏุฉ ููู ูุงุฑุบุฉ**
4. **ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ ุฌุงูุฒุฉ**
5. **ุงููุธุงู ูุจุณุท ุฌุฏุงู**

## ๐ **ุงูุฎุทูุงุช ุงูุชุงููุฉ:**

ุจุนุฏ ุชุดุบูู SQL ุจูุฌุงุญ:
1. **ุงุฑุฌุน ููุชุทุจูู**
2. **ุฌุฑุจ ุญุฌุฒ ููุนุฏ ุฌุฏูุฏ**
3. **ุชุญูู ูู ุฃู ุงููุธุงู ูุนูู ุจุฏูู ุฃุฎุทุงุก**
4. **ุชุฃูุฏ ูู ุธููุฑ ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ**
5. **ุฅุฐุง ุนูู ุงููุธุงูุ ูููู ุฅุถุงูุฉ trigger ูุงุญูุงู**

## ๐ง **ุฅุถุงูุฉ ุงูุทุงุจูุฑ ูุงุญูุงู:**

ุฅุฐุง ุนูู ุงููุธุงู ุจุดูู ุฃุณุงุณูุ ูููู ุฅุถุงูุฉ trigger ูุงุญูุงู ูุญุณุงุจ ุงูุทุงุจูุฑ ุชููุงุฆูุงู:

```sql
-- ุฅุถุงูุฉ trigger ูุงุญูุงู
CREATE OR REPLACE FUNCTION update_queue_on_appointment()
RETURNS TRIGGER AS $$
BEGIN
  -- ุญุณุงุจ ุฑูู ุงูุทุงุจูุฑ ุงูุชุงูู
  SELECT COALESCE(MAX(queue_number), 0) + 1 
  INTO NEW.queue_number
  FROM book_service_appointments 
  WHERE clinic_id = NEW.clinic_id 
    AND appointment_date = NEW.appointment_date
    AND status IN ('pending', 'confirmed');
  
  -- ุญุณุงุจ ููุถุน ุงููุฑูุถ
  NEW.queue_position := NEW.queue_number;
  
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_update_queue
  BEFORE INSERT ON book_service_appointments
  FOR EACH ROW
  EXECUTE FUNCTION update_queue_on_appointment();
```

---
**ุชุงุฑูุฎ ุงูุฅุตูุงุญ**: 2025-01-25  
**ุงูุญุงูุฉ**: ุงูุฌุฏุงูู ุงูุฃุณุงุณูุฉ ุฌุงูุฒุฉ โ
