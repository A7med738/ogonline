# ุงูุญู ุงูุดุงูู ูุงูุฏููู ููุธุงู ุงุญุฌุฒูู

## โ **ุงููุดููุฉ:**
```
ERROR: 42703: column "queue_number" does not exist
```

## ๐ฏ **ุงูุญู ุงูุดุงูู:**
**ุญู ุดุงูู ูุฏููู ูุจุฏุฃ ูู ุงูุตูุฑ ููุถูู ุฅูุดุงุก ุฌููุน ุงูุฌุฏุงูู ูุงูุฃุนูุฏุฉ**

## โ **ุงูุฎุทูุงุช:**

### **ุงูุฎุทูุฉ 1: ุงุณุชุฎุฏุงู ุงูุญู ุงูุดุงูู**

**ุงุณุชุฎุฏู ููู `COMPLETE_SOLUTION.sql` - ูุฐุง ูู ุงูุญู ุงูุดุงูู ูุงูุฏููู**

### **ุงูุฎุทูุฉ 2: ุชุดุบูู SQL ูู Supabase Dashboard**

1. **ุงูุชุญ Supabase Dashboard:**
   - ุงุฐูุจ ุฅูู: https://supabase.com/dashboard
   - ุงุฎุชุฑ ูุดุฑูุนู

2. **ุงูุชุญ SQL Editor:**
   - ุงุถุบุท ุนูู "SQL Editor" ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ
   - ุงุถุบุท ุนูู "New query"

3. **ุงูุณุฎ ูุงูุตู ุงูููุฏ:**
   - ุงูุชุญ ููู `COMPLETE_SOLUTION.sql`
   - ุงูุณุฎ ุฌููุน ูุญุชููุงุช ุงูููู
   - ุงูุตู ูู SQL Editor

4. **ุดุบู ุงูููุฏ:**
   - ุงุถุบุท ุนูู "Run" ุฃู `Ctrl+Enter`
   - ุงูุชุธุฑ ุญุชู ููุชูู ุงูุชูููุฐ

### **ุงูุฎุทูุฉ 3: ุงูุชุญูู ูู ุงูุฌุฏุงูู**

1. **ุงุฐูุจ ุฅูู Table Editor:**
   - ุงุถุบุท ุนูู "Table Editor" ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ

2. **ุชุญูู ูู ุงูุฌุฏุงูู ุงูุฌุฏูุฏุฉ:**
   - `book_service_health_centers`
   - `book_service_clinics`
   - `book_service_appointments`

## ๐ง **ูุง ูููุฒ ูุฐุง ุงูุญู:**

### **1. ุงูุญุฐู ุงููุงูู ุฃููุงู:**
- **ุญุฐู ุฌููุน ุงูุฌุฏุงูู ุงูููุฌูุฏุฉ** ุจุงุณุชุฎุฏุงู `DROP TABLE IF EXISTS ... CASCADE`
- **ุถูุงู ุงูุจุฏุก ูู ุงูุตูุฑ** ุจุฏูู ุฃู ุชุฏุงุฎู

### **2. ุงูุฅูุดุงุก ุงููุงูู:**
- **ุฅูุดุงุก ุงูุฌุฏุงูู ูู ุงูุตูุฑ** ุจุงุณุชุฎุฏุงู `CREATE TABLE`
- **ุถูุงู ูุฌูุฏ ุฌููุน ุงูุฃุนูุฏุฉ** ุจูุง ูู ุฐูู `queue_number` ู `queue_position`

### **3. ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ:**
- **ูุฑูุฒ ุตุญู ูุงุญุฏ** ูุน ุฌููุน ุงูุชูุงุตูู
- **11 ุนูุงุฏุฉ ูุฎุชููุฉ** ูุน ุฃุทุจุงุก ูุชุฎุตุตูู
- **ุจูุงูุงุช ูุงููุฉ ูุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู**

### **4. ุงูุฃูุงู ูุงูุณูุงุณุงุช:**
- **ุชูุนูู RLS** ูุฌููุน ุงูุฌุฏุงูู
- **ุณูุงุณุงุช ุฃูุงู ุดุงููุฉ** ูููุณุชุฎุฏููู ูุงููุฏูุฑูู
- **ุญุฐู ุงูุณูุงุณุงุช ุงููุฏููุฉ** ูุจู ุฅูุดุงุก ุงูุฌุฏูุฏุฉ

### **5. ุงูููุงุฑุณ ูุงูุฃุฏุงุก:**
- **ููุงุฑุณ ุดุงููุฉ** ูุชุญุณูู ุงูุฃุฏุงุก
- **ููุงุฑุณ ุนูู ุงูุฃุนูุฏุฉ ุงููููุฉ** ูุซู `clinic_id`, `user_id`, `queue_number`

### **6. ุงูุชุญูู ุงูููุงุฆู:**
- **ุงุณุชุนูุงู ููุชุญูู** ูู ุฅูุดุงุก ุงูุฌุฏุงูู ูุงูุฃุนูุฏุฉ
- **ุนุฑุถ ูููู ุงูุฌุฏุงูู** ููุชุฃูุฏ ูู ุตุญุฉ ุงูุฅูุดุงุก

## ๐ **ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ:**

### **ุงููุฑูุฒ ุงูุตุญู:**
- **ุงูุงุณู:** ูุฑูุฒ ุงูุตุญุฉ ุงูุดุงูู
- **ุงูุนููุงู:** ุดุงุฑุน ุงูููู ููุฏุ ุญู ุงููุฎููุ ุงูุฑูุงุถ
- **ุงููุงุชู:** +966501234567
- **ุงูุชูููู:** 4.8/5
- **ุงูุฎุฏูุงุช:** ุทุจ ุนุงูุ ุฃุทูุงูุ ูุณุงุก ูููุงุฏุฉุ ุฃุณูุงูุ ุนูููุ ุฃูู ูุฃุฐู ูุญูุฌุฑุฉุ ุฌูุฏูุฉุ ุนุธุงูุ ููุจุ ุฃุนุตุงุจ

### **ุงูุนูุงุฏุงุช:**
1. **ุนูุงุฏุฉ ุงูุทุจ ุงูุนุงู** - ุฏ. ุฃุญูุฏ ูุญูุฏ (150 ุฑูุงู)
2. **ุนูุงุฏุฉ ุงูุฃุทูุงู** - ุฏ. ูุงุทูุฉ ุนูู (200 ุฑูุงู)
3. **ุนูุงุฏุฉ ุงููุณุงุก ูุงูููุงุฏุฉ** - ุฏ. ูุฑูู ุญุณู (300 ุฑูุงู)
4. **ุนูุงุฏุฉ ุงูุฃุณูุงู** - ุฏ. ุฎุงูุฏ ุนุจุฏุงููู (250 ุฑูุงู)
5. **ุนูุงุฏุฉ ุงูุนููู** - ุฏ. ููุฑุง ุณุนุฏ (180 ุฑูุงู)
6. **ุนูุงุฏุฉ ุงูุฃูู ูุงูุฃุฐู** - ุฏ. ุนูุฑ ููุณู (220 ุฑูุงู)
7. **ุนูุงุฏุฉ ุงูุฌูุฏูุฉ** - ุฏ. ูููุง ูุญููุฏ (200 ุฑูุงู)
8. **ุนูุงุฏุฉ ุงูุนุธุงู** - ุฏ. ุณุนุฏ ุงูุฏูู (280 ุฑูุงู)
9. **ุนูุงุฏุฉ ุงูููุจ** - ุฏ. ูุฏู ุฃุญูุฏ (350 ุฑูุงู)
10. **ุนูุงุฏุฉ ุงูุฃุนุตุงุจ** - ุฏ. ููุณู ูุญูุฏ (320 ุฑูุงู)
11. **ุนูุงุฏุฉ ุงูุจุงุทูุฉ** - ุฏ. ุฑูู ุนุจุฏุงูุฑุญูู (240 ุฑูุงู)

## ๐ฏ **ุงููุชูุฌุฉ ุงููุชููุนุฉ:**

ุจุนุฏ ุชุดุบูู SQL:
- โ **ุงูุฌุฏุงูู ุณุชููุดุฃ ุจุฏูู ุฃุฎุทุงุก**
- โ **ุฌููุน ุงูุฃุนูุฏุฉ ุณุชููู ููุฌูุฏุฉ** ุจูุง ูู ุฐูู `queue_number`
- โ **ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ ุณุชููู ุฌุงูุฒุฉ**
- โ **ุงููุธุงู ุณูุนูู ุจุดูู ูุงูู**
- โ **ุณูุชู ุนุฑุถ ูููู ุงูุฌุฏุงูู** ููุชุฃูุฏ ูู ุตุญุฉ ุงูุฅูุดุงุก

## โ๏ธ **ููุงุญุธุงุช ูููุฉ:**

1. **ุงุณุชุฎุฏู ุงูุญู ุงูุดุงูู:** `COMPLETE_SOLUTION.sql`
2. **ูุฐุง ุงูุญู ูุจุฏุฃ ูู ุงูุตูุฑ** ููุญุฐู ูู ุดูุก ููุฌูุฏ
3. **ุฌููุน ุงูุฃุนูุฏุฉ ุณุชููู ููุฌูุฏุฉ** ุจูุง ูู ุฐูู `queue_number`
4. **ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ ุฌุงูุฒุฉ** ููุงุณุชุฎุฏุงู ุงูููุฑู
5. **ุงููุธุงู ุดุงูู ููุชูุงูู**

## ๐ **ุงูุฎุทูุงุช ุงูุชุงููุฉ:**

ุจุนุฏ ุชุดุบูู SQL ุจูุฌุงุญ:
1. **ุชุญูู ูู ุธููุฑ ุงูุฌุฏุงูู** ูู Table Editor
2. **ุงุฑุฌุน ููุชุทุจูู**
3. **ุฌุฑุจ ุญุฌุฒ ููุนุฏ ุฌุฏูุฏ**
4. **ุชุญูู ูู ุฃู ุงููุธุงู ูุนูู ุจุฏูู ุฃุฎุทุงุก**
5. **ุชุฃูุฏ ูู ุธููุฑ ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ**

## ๐ง **ุฅุถุงูุฉ ุงูุทุงุจูุฑ ุงูุชููุงุฆู ูุงุญูุงู:**

ุฅุฐุง ุนูู ุงููุธุงู ุจุดูู ุฃุณุงุณูุ ูููู ุฅุถุงูุฉ trigger ูุงุญูุงู ูุญุณุงุจ ุงูุทุงุจูุฑ ุชููุงุฆูุงู:

```sql
-- ุฅุถุงูุฉ trigger ูุงุญูุงู
CREATE OR REPLACE FUNCTION update_queue_on_appointment()
RETURNS TRIGGER AS $$
BEGIN
  -- ุญุณุงุจ ุฑูู ุงูุทุงุจูุฑ ุงูุชุงูู
  SELECT COALESCE(MAX(queue_number), 0) + 1 
  INTO NEW.queue_number
  FROM book_service_appointments 
  WHERE clinic_id = NEW.clinic_id 
    AND appointment_date = NEW.appointment_date
    AND status IN ('pending', 'confirmed');
  
  -- ุญุณุงุจ ููุถุน ุงููุฑูุถ
  NEW.queue_position := NEW.queue_number;
  
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_update_queue
  BEFORE INSERT ON book_service_appointments
  FOR EACH ROW
  EXECUTE FUNCTION update_queue_on_appointment();
```

## ๐ **ุงูุชุญูู ูู ุงููุฌุงุญ:**

ุจุนุฏ ุชุดุบูู SQLุ ูุฌุจ ุฃู ุชุฑู ูู ุงููุชูุฌุฉ:
- **ุฌุฏูู `book_service_health_centers`** ูุน 15 ุนููุฏ
- **ุฌุฏูู `book_service_clinics`** ูุน 10 ุฃุนูุฏุฉ
- **ุฌุฏูู `book_service_appointments`** ูุน 15 ุนููุฏ ุจูุง ูู ุฐูู `queue_number`

---
**ุชุงุฑูุฎ ุงูุฅุตูุงุญ**: 2025-01-25  
**ุงูุญุงูุฉ**: ุงูุญู ุงูุดุงูู ูุงูุฏููู ุฌุงูุฒ โ
